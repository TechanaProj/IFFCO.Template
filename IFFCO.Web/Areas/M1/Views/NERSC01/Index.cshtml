@model IFFCO.NERRS.Web.ViewModels.NERSC01ViewModel

@{
    ViewData["Title"] = "Index";
    //Layout = "~/Views/Shared/_Layout.cshtml";
}


<script src="~/js/Common.js"></script>

<script>

    function fnGet_Data() {
        var OccupantList = $('#OccupantList option:selected').val();
        var OccupantCode = $('#OccupantCode option:selected').val();

        var PlantCD = $('#PlantCD').val();

        if (typeof PlantCD == "undefined" || PlantCD == null || PlantCD.trim() == "") {
            CommonAlert("Alert", "select Plant CD  ", null, null, "Warning");
            return false;
            
        } else if (OccupantCode == "") {
            CommonAlert("Alert", "Select Occupant type ", null, null, "Warning");
            return false;
        }
        else {

            PageNotLoad('@Url.Action("Index", "NERSC01", new {area="M1"})?PlantCD=' + PlantCD + '&OccupantType=' + OccupantList + '&OccupantCode=' + OccupantCode, this)
            //window.location = '@Url.Action("Index", "NERSC01", new {area="M1"})?PlantCD=' + PlantCD + '&OccupantList=' + OccupantList + '&OccupantCode=' + OccupantCode;
        }
    }

    function Validate() {


        debugger;
        if ($('#PlantCD').val() == "") {
            CommonAlert("Alert", "select Plant CD  ", null, null, "Warning");
            return false;
            //} else if ($('#FFromDate').val() == "=") {
            //    CommonAlert("Alert", "Select From Date ", null, null, "Warning");
            //    return false;
            //} else if ($('#FToDate').val() == "") {
            //    CommonAlert("Alert", "Select To Date ", null, null, "Warning");
            //    return false;
        } else if ($('#OccupantCode').val() == "") {
            CommonAlert("Alert", "Select Occupant type ", null, null, "Warning");
            return false;
        }
        else {
            // $('#FFromDate').val(Dateformate($('#FFromDate').val())).removeClass("datetime");
            // $('#FToDate').val(Dateformate($('#FToDate').val())).removeClass("datetime");
            return true;
        }
    }


</script>


<div class="plcholder-cn">

    <div class="table-responsive">
        <div class="table-area">
            <div class="table-title">
                <div class="btn-area-tbl">
                </div>
            </div>
            <div class="table-wrapper">

                <div class="table-con">
                    <div class="tableUp">
                        @*<div class="pd-form-area">*@
                        <div class="content-box">
                            <h3 class="sub-heading1"><span>Allotment details</span></h3>
                            <div class="m-form">
                                <form asp-area="M1" asp-controller="NERSC01" asp-action="Query" method="post" onsubmit="return Validate();">
                                    <div class="m-form">
                                        <div class="m-form-bx">
                                            <div class="m-form-bx">
                                                <div class="row form-sm">
                                                    <div class="col-sm-1 col-md-2">
                                                        <div>
                                                            <label class="m-lbl1 m-lbl2">Plant Code</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-sm-2 col-md-2">
                                                        <div>
                                                            <select id="PlantCD" name="PlantCD" class="form-control" asp-items="@(new SelectList(Model.UnitLOVBind,"Value","Text", Model.PlantCD))"></select>
                                                        </div>
                                                    </div>

                                                    <div class="col-sm-2 col-md-2">
                                                        <div>
                                                            <label class="m-lbl1 m-lbl2">Type:</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-sm-2 col-md-2">
                                                        <div>
                                                            <select id="OccupantList" onchange="PopOccupantLOV()" name="Occupant" asp-for="@Model.Occupant" class="form-control">
                                                                <option value="">--SELECT--</option>
                                                                <option value="E"> Employee </option>
                                                                <option value="N"> Non-Employee </option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="col-sm-2 col-md-2">
                                                        <div>
                                                            <label class="m-lbl1 m-lbl2">Occupant List</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-sm-2 col-md-2">
                                                        <div>
                                                            <select id="OccupantCode" name="OccupantCode" class="form-control" asp-items="@(new SelectList(Model.OccupantLOVBind,"Value","Text", Model.OccupantCode))"><option value="">--SELECT--</option></select>

                                                        </div>
                                                    </div>


                                                </div>

                                                @*
                                                <div class="row form-sm">

                                                <div class="col-sm-2 col-md-2">
                                                <div>
                                                <label class="m-lbl1 m-lbl2"> From Date</label>
                                                </div>
                                                </div>
                                                <div class="col-sm-2 col-md-2">
                                                <div>
                                                <input type="date" class="form-control" id="FFromDate" />

                                                </div>
                                                </div>
                                                <div class="col-sm-2 col-md-2">
                                                <div>
                                                <label class="m-lbl1 m-lbl2">End Date</label>
                                                </div>
                                                </div>
                                                <div class="col-sm-2 col-md-2">
                                                <div>
                                                <input type="date" class="form-control" id="FToDate" />

                                                </div>
                                                </div>
                                                </div>
                                                <div class="row form-sm">


                                                <div class="col-sm-2 col-md-2">
                                                <div>
                                                <label class="m-lbl1 m-lbl2"> Personal No</label>
                                                </div>
                                                </div>
                                                <div class="col-sm-2 col-md-2">
                                                <div>
                                                <input type="text" class="form-control" />

                                                </div>
                                                </div>


                                                <div class="col-sm-2 col-md-2">
                                                <div>
                                                <label class="m-lbl1 m-lbl2">Quarter type</label>
                                                </div>
                                                </div>
                                                <div class="col-sm-2 col-md-2">
                                                <div>

                                                <select id="RentTypeLOV" class="form-control" asp-items="@(new SelectList(Model.RentTypeLOVBind,"Value","Text"))" asp-for="@Model.RentCode"><option value="">--SELECT--</option></select>

                                                </div>
                                                </div>
                                                </div>
                                                *@
                                                @*
                                                <div class="row form-sm">

                                                <div class="col-sm-4 col-md-4">
                                                <div>
                                                <select id="RoadDILOV" class="form-control"><option value="">--SELECT--</option></select>
                                                <input type="hidden" id="SelectedDi" />
                                                </div>
                                                </div>


                                                </div>*@

                                            </div>
                                        </div>
                                        <div class="btn-area1">
                                            @*<input type="submit" id="save" onclick="Query()" class="m-btn-1 save" value="Fetch Rent details" />*@
                                            <button type="button" id="save" onclick="fnGet_Data()" class="m-btn-1 btn-success">Fetch Rent details</button>
                                            <input type="reset" id="save" class="m-btn-1 btn-warning" value="Reset" />

                                            </di>
                                        </div>
                                </form>
                            </div>
                        </div>
                        @*</div>*@
                    </div>
                </div>
                <div class="table-con">
                    <div class="tableUp">
                        <div class="pd-form-area">
                            <div class="btn-area-tbl">
                                <a id="addnew" class="m-btn-1 addnew @Model.Insert addnewitem"><i class="material-icons"></i><span>Add New Occupant</span></a>

                            </div>
                            <table class="table table-striped table-hover" id="HrmsHrdGrid">
                                <thead>
                                    <tr>
                                        <th>
                                            Personal No
                                        </th>
                                        <th>
                                            Quarter Type
                                        </th>
                                        <th>
                                            Quarter No
                                        </th>
                                        <th>
                                            Allotment No
                                        </th>
                                        <th>
                                            Allotment Date
                                        </th>
                                        <th>
                                            Occupany Date
                                        </th>
                                        <th>
                                            Vacancy Date
                                        </th>
                                        <th >
                                            Occupant
                                        </th>
                                        <th>
                                            Quarter Rent
                                        </th>

                                        <th>Actions</th>
                                    </tr>

                                </thead>

                                <tbody id="consultantData">

                                    @foreach (var item in Model.listVwAonlaConsultantAllotStatus)
                                    {
                                        <tr id="tr_@(item.UnitCode)_@(item.AllotmentNo)_@(item.PersonalNo)" data-ischange="0">
                                            <td>

                                                @Html.DisplayFor(modelItem => item.PersonalNo)
                                            </td>
                                            
                                            <td>
                                                @Html.DisplayFor(modelItem => item.QuarterCategory)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.QuarterNo)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.AllotmentNo)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.ApprovedDate)
                                            </td>
                                            <td id="td_Rent_@(item.UnitCode)_@(item.AllotmentNo)_@(item.PersonalNo)">
                                                @Html.DisplayFor(modelItem => item.OccupancyDate)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.VacancyDate)
                                            </td>
                                            <td>
                                                <select id="OccupantTypeLOV" class="form-control" asp-items="@(new SelectList(Model.OccupantLOVBind,"Value","Text"))" asp-for="@Model.OccupantLOVBind"><option value="">--SELECT--</option></select>

                                            </td>
                                            <td>
                                                <select id="RentTypeLOV" class="form-control" asp-items="@(new SelectList(Model.RentTypeLOVBind,"Value","Text"))" asp-for="@Model.RentCode"><option value="">--SELECT--</option></select>

                                            </td>

                                            <td>
                                                <input type="checkbox" class="form-control" data-id="@item.AllotmentNo" /> @* save-checkbox*@
                                            </td>

                                        </tr>
                                    }
                                   </tbody>
                                <tbody id="exEmpData">
                                    @foreach (var item in Model.listVwAonlaExEmpAllotStatus)
                                    {
                                        <tr>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.PersonalNo)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.QuarterCategory)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.QuarterNo)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.AllotmentNo)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.ApprovedDate)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.OccupancyDate)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.VacancyDate)
                                            </td>
                                            <td>
                                                <select id="OccupantTypeLOV" class="form-control" asp-items="@(new SelectList(Model.OccupantLOVBind,"Value","Text"))" asp-for="@Model.OccupantLOVBind"><option value="">--SELECT--</option></select>

                                            </td>
                                            <td>
                                                <select id="RentTypeLOV" class="form-control" asp-items="@(new SelectList(Model.RentTypeLOVBind,"Value","Text"))" asp-for="@Model.RentCode"><option value="">--SELECT--</option></select>

                                            </td>
                                            <td>
                                                <input type="checkbox" class="save-checkbox" data-id="@item.AllotmentNo" />
                                            </td>
                                            <td >


                                        </tr>
                                    }
</tbody>
                                <tbody id="nonEmpData">
                                    @foreach (var item in Model.listVwAonlaNonEmpAllotStatus)
                                    {
                                        <tr>
                                            <td>
                                                 @Html.DisplayFor(modelItem => item.QuarterNameFor)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.QuarterCategory)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.QuarterNo)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.AllotmentNo)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.ApprovedDate)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.OccupancyDate)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.VacancyDate)
                                            </td>
                                            <td>
                                                <select id="OccupantTypeLOV" class="form-control" asp-items="@(new SelectList(Model.OccupantLOVBind,"Value","Text"))" asp-for="@Model.OccupantLOVBind" style="width:100%"><option value="">--SELECT--</option></select>

                                            </td>
                                            <td>
                                                <select id="RentTypeLOV" class="form-control" asp-items="@(new SelectList(Model.RentTypeLOVBind,"Value","Text"))" asp-for="@Model.RentCode" style="width:70%"><option value="">--SELECT--</option></select>

                                            </td>
                                            <td>
                                                <input type="checkbox" class="save-checkbox" data-id="@item.AllotmentNo" />
                                            </td>
                                            <td >


                                        </tr>
                                    }


                                </tbody>

                            </table>
                                <div class="btn-area1 btn-area-fixed">
                                     <button type="button" class="m-btn-1 save  @Model.Insert" onclick="SaveAccessToDB()">Save</button>
                                </div>

                        </div>
                    </div>
                </div>
               
            </div>
        </div>
    </div>
</div>


<div id="commonModalbinder" class="modal" style="display:none!important;z-index:99999999 !important;"></div>


<script type="text/javascript">

  


    $("#PlantCD").change(function () {
        AddNewURLBuilder();
    });

    function AddNewURLBuilder() {
        var PlantCD = $('#PlantCD').val();
        $("#addnew").attr("href", "M1/NERSC01/Create/" + PlantCD);
    }



    function PopOccupantLOV() {
        debugger;
        $(".modalLoader").css("display", "block");
        setTimeout(function () {
            CommonAjax('/M1/NERSC01/OccupantLOVBindJSON', "GET", false, "application/json", false, BindDropDownWithSelectAsNull, "#OccupantCode", { OccupantType: $('#OccupantList').val() });

            $(".modalLoader").hide();
        }, 10);
    }

    $(document).ready(function () {
        debugger;
        $('#HrmsHrdGrid').DataTable();
       
        var exportfilename = $("#PlantCD").val() + "-RentList(" + $("#OccupantCode").val() + ")";
       
        BindGridWithIdCol([0, 1, 2, 3, 4, 5, 8, 9, 10], [0, 1, 2, 3, 4, 5, 8, 9, 10], '#HrmsHrdGrid', exportfilename);
        BootStrapCalender(".datetime");
        AddNewURLBuilder();
    });

</script>
